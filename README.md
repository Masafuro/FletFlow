# FletFlow

[**English**](README_EN.md)

- FletFlowは、簡単に開発できる業務用の安定したリアルタイムシステムで、Flet GUIを活用し進捗追跡、状態更新、エラーハンドリングを提供します。
- GUI側とバックエンド側のやりとり規則をあらかじめ決めておくことで、完全に分割した開発が可能です。

## FletFlowにおけるインターフェース分類

FletFlowでは、ユーザーインターフェース（UI）の要素を3つの主要なタイプに分類しています。この分類により、各UI要素の役割が明確化され、構造的なデザインとフロントエンド・バックエンド間のスムーズなデータフローが実現されます。

| タイプ             | 説明                                         | 役割                                                                                     | 例                                                   |
|--------------------|----------------------------------------------|------------------------------------------------------------------------------------------|------------------------------------------------------|
| **単純表示部**      | ユーザーの操作に影響されず、固定の内容を表示する要素。 | プログラム名や固定のテキスト、ロゴなど、インタラクティブでない基本情報を提供。              | アプリケーションのタイトル、著作権情報、装飾画像       |
| **可変表示部**      | ユーザーの入力や選択によって内容が変化する要素。     | ユーザーの入力や選択内容を保持し、後の処理に利用できるようにする。                         | カレンダー入力、トグル/スイッチ、カウンター、テキストフィールド |
| **処理実行部**      | 可変表示部の入力に基づいてデータ処理を開始する要素。  | トリガーとして機能し、可変表示部に保持されたデータをバックエンドに送信。                    | 実行ボタン、リセットボタン                              |

## FletFlowにおけるデータ送受信モード

FletFlowでは、実行ボタンなどの処理実行部のUIがユーザーによって押されると、システムは**データ送受信モード**に移行します。このモードでは、可変表示部のデータがPythonの`multiprocessing`モジュールを使用して別プロセスで起動しているバックエンドシステムに送信されます。これにより、ユーザーインターフェースをブロックせずにスムーズなデータ処理が可能になります。

### 送受信に使用されるデータテーブル

FletFlowでは、GUIとバックエンドの間で信頼性のある通信を行うため、構造化されたデータテーブルを使用します。GUIとバックエンド間でやり取りされる各メッセージは、以下のデータテーブル形式に従います。このテーブルには、メッセージの種類、コマンド、状態、データ内容、および追加の詳細情報などが含まれています。

| フィールド名       | 説明                                               | 例                                                |
|--------------------|----------------------------------------------------|---------------------------------------------------|
| `type`            | メッセージの種類を指定                              | `"request"`、`"response"`、`"complete"`            |
| `command`         | 実行するアクションや関数を指定                      | `"calculate"`、`"update_status"`                  |
| `status`          | 処理の進捗やレスポンスの状態を示す                   | `"progress"`、`"success"`、`"error"`              |
| `data`            | 処理に必要なコアデータを含む                         | `{"operand1": 5, "operand2": 3, "operation": "multiply"}` |
| `details`         | 追加情報やエラーメッセージを提供                     | `"Calculation completed."`、`"Invalid input"`     |

## データ送受信モードにおける通信フロー

データ送受信モード中、FletFlowは安定した処理環境を確保するためにすべてのGUI入力を無効化します。モード終了後、再度入力が有効化されます。以下の表に各ステップの通信フローを示します。

| ステップ                                | 説明                                                                                                   | 目的                                                                                      |
|----------------------------------------|--------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|
| **1. データ送受信モードに移行**           | 処理実行部が起動されると、GUIがデータ送受信モードに入り、すべての入力要素を無効化します。                 | 処理中のユーザー操作を防ぎ、安定性を確保。                                                |
| **2. データをバックエンドに送信**         | GUIが`multiprocessing`を使用して構造化されたデータテーブル形式でデータをバックエンドに送信します。         | 一貫したデータ構造と信頼性のある通信を実現。                                              |
| **3. バックエンドでの処理**              | バックエンドが`command`で指定されたコマンドを処理し、進捗やエラーに応じた`response`メッセージを送信します。 | 処理中にリアルタイムの更新、進捗、エラー情報を提供。                                      |
| **4. リアルタイムレスポンス処理**         | GUIがバックエンドからの`response`メッセージをリッスンし、`status`や`data`に基づいてUIを更新します。         | 最新の状態、進捗、エラーをUIに反映しつつ、入力は無効のまま維持。                          |
| **5. データ送受信モードの終了**           | `complete`メッセージを受信後、GUIがデータ送受信モードを終了し、すべての入力要素が再度有効化されます。       | UIの操作性を復元し、ユーザーが新たな操作を行えるようにする。                              |

この表により、データ送受信モード中にフロントエンドとバックエンドが円滑にやり取りし、安定したインタラクションを維持するための各ステップの役割が示されています。
